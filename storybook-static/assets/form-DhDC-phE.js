import{D as l,$ as a}from"./get-IZFZkHlF.js";import{b as f,a as u,f as c}from"./class-map-CWCTosL-.js";const r=new WeakMap,p=h=>{const o=[...h.elements],s=r.get(h)||[],t=(i,e)=>i.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1;return[...o,...s].sort(t)},n=new WeakMap,m=new WeakMap;class V{constructor(o,s){(this.host=o).addController(this),this.definedController=new l(o,{needDomReady:!0}),this.options={form:t=>{const i=a(t).attr("form");return i?t.getRootNode().getElementById(i):t.closest("form")},name:t=>t.name,value:t=>t.value,defaultValue:t=>t.defaultValue,setValue:(t,i)=>t.value=i,disabled:t=>t.disabled,reportValidity:t=>f(t.reportValidity)?t.reportValidity():!0,...s},this.onFormData=this.onFormData.bind(this),this.onFormSubmit=this.onFormSubmit.bind(this),this.onFormReset=this.onFormReset.bind(this),this.reportFormValidity=this.reportFormValidity.bind(this)}hostConnected(){this.definedController.whenDefined().then(()=>{this.form=this.options.form(this.host),this.form&&this.attachForm(this.form)})}hostDisconnected(){this.detachForm()}hostUpdated(){this.definedController.whenDefined().then(()=>{const o=this.options.form(this.host);o||this.detachForm(),o&&this.form!==o&&(this.detachForm(),this.attachForm(o))})}getForm(){return this.form??null}reset(o){this.doAction("reset",o)}submit(o){this.doAction("submit",o)}attachForm(o){if(!o){this.form=void 0;return}this.form=o,r.has(this.form)?r.get(this.form).add(this.host):r.set(this.form,new Set([this.host])),this.form.addEventListener("formdata",this.onFormData),this.form.addEventListener("submit",this.onFormSubmit),this.form.addEventListener("reset",this.onFormReset),n.has(this.form)||(n.set(this.form,this.form.reportValidity),this.form.reportValidity=()=>this.reportFormValidity())}detachForm(){this.form&&(r.get(this.form).delete(this.host),this.form.removeEventListener("formdata",this.onFormData),this.form.removeEventListener("submit",this.onFormSubmit),this.form.removeEventListener("reset",this.onFormReset),n.has(this.form)&&!r.get(this.form).size&&(this.form.reportValidity=n.get(this.form),n.delete(this.form)))}doAction(o,s){if(!this.form)return;const t=a(`<button type="${o}">`).css({position:"absolute",width:0,height:0,clipPath:"inset(50%)",overflow:"hidden",whiteSpace:"nowrap"}),i=t[0];s&&(i.name=s.name,i.value=s.value,["formaction","formenctype","formmethod","formnovalidate","formtarget"].forEach(e=>{t.attr(e,a(s).attr(e))})),this.form.append(i),i.click(),i.remove()}onFormData(o){const s=this.options.disabled(this.host),t=this.options.name(this.host),i=this.options.value(this.host),e=["mdui-button","mdui-button-icon","mdui-chip","mdui-fab","mdui-segmented-button"].includes(this.host.tagName.toLowerCase());!s&&!e&&u(t)&&t&&!c(i)&&(Array.isArray(i)?i.forEach(d=>{o.formData.append(t,d.toString())}):o.formData.append(t,i.toString()))}onFormSubmit(o){const s=this.options.disabled(this.host),t=this.options.reportValidity;this.form&&!this.form.noValidate&&!s&&!t(this.host)&&(o.preventDefault(),o.stopImmediatePropagation())}onFormReset(){this.form&&(this.options.setValue(this.host,this.options.defaultValue(this.host)),this.host.invalid=!1,m.has(this.form)?m.get(this.form).add(this.host):m.set(this.form,new Set([this.host])))}reportFormValidity(){if(this.form&&!this.form.noValidate){const o=p(this.form);for(const s of o)if(f(s.reportValidity)&&!s.reportValidity())return!1}return!0}}export{V as F,m as f};
